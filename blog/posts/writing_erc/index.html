<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-10-01">
<meta name="description" content="A letter to my younger self (while procrastinating on revisions)">

<title>Lessons Learned from Writing My First ERC Proposal – Kevin’s Homepage</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-689f630c68528effd541efe951e5b377.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-6b90edb051655fd0a8834bbf993daeb8.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-S9W9LVHXJK"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-S9W9LVHXJK', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../../../styles.css">
<meta property="og:title" content="Lessons Learned from Writing My First ERC Proposal – Kevin’s Homepage">
<meta property="og:description" content="A letter to my younger self (while procrastinating on revisions)">
<meta property="og:image" content="https://kjablonka.com/blog/posts/writing_erc/quarto.png">
<meta property="og:site_name" content="Kevin's Homepage">
<meta name="twitter:title" content="Lessons Learned from Writing My First ERC Proposal – Kevin’s Homepage">
<meta name="twitter:description" content="A letter to my younger self (while procrastinating on revisions)">
<meta name="twitter:image" content="https://kjablonka.com/blog/posts/writing_erc/quarto.png">
<meta name="twitter:creator" content="@kmjablonka">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
  </div>
          <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html"> <i class="bi bi-home" role="img">
</i> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
          <div class="quarto-navbar-tools">
</div>
            <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lessons Learned from Writing My First ERC Proposal</h1>
  <div class="quarto-categories">
    <div class="quarto-category">academia</div>
    <div class="quarto-category">writing</div>
    <div class="quarto-category">grants</div>
  </div>
  </div>

<div>
  <div class="description">
    <i>A letter to my younger self (while procrastinating on revisions)</i>
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 1, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Dear younger me,</p>
<p>I’m writing this instead of revising the proposal. I know, I know—classic avoidance behavior. But maybe writing this down will help me (you? us?) make sense of what just happened. Or rather: what is happening.</p>
<p>You’re about to write your first ERC proposal, and it’s going to take a bigger emotional toll than any writing you’ve done before. Yes, even though you love writing. Especially because you love writing.</p>
<p>Let me tell you what I wish I’d known.</p>
<section id="youre-going-to-forget-which-game-youre-playing" class="level2">
<h2 class="anchored" data-anchor-id="youre-going-to-forget-which-game-youre-playing">You’re Going to Forget Which Game You’re Playing</h2>
<p>Here’s what’s going to happen: You’ll get so caught up in what James Carse calls the “finite game” <span class="citation" data-cites="carse1986finite">(<a href="#ref-carse1986finite" role="doc-biblioref">Carse 1986</a>)</span> that you’ll forget about the infinite game entirely.</p>
<p>The finite game is winning the ERC. The infinite game? That’s the research itself—the questions that genuinely excite you, the work you’d want to do regardless of whether anyone gives you money for it.</p>
<p>Carse distinguishes between games we play to win (finite) and games we play to keep playing (infinite). Your proposal will be full of research you find genuinely important, exciting, and novel. But somewhere along the way, the narrative will become “winning the ERC is the only way to do this exciting work.”</p>
<p>That’s not true. You know that’s not true. But you’re going to forget it anyway.</p>
<p>And look—I know you’re hungry for a win right now. After the losses you’ve experienced recently (and we both know what I’m talking about), you need this. I get it. But being thirsty for a win makes it almost impossible to stay in the infinite game mindset.</p>
<p>Try anyway.</p>
</section>
<section id="someone-will-tell-you-youre-late-youre-not" class="level2">
<h2 class="anchored" data-anchor-id="someone-will-tell-you-youre-late-youre-not">Someone Will Tell You You’re Late (You’re Not)</h2>
<p>An advisor is going to tell you you’re late. This will happen when you have a 17-page draft completed, 1.5 months before the deadline.</p>
<p>You’re not late.</p>
<p>But their anxiety will become your anxiety, and you’ll carry that weight through the rest of the process. I wish I could tell you how to avoid internalizing this, but I can’t. Just… know that it’s happening. Maybe that awareness will help a little.</p>
</section>
<section id="youre-writing-for-everyone-which-means-no-one" class="level2">
<h2 class="anchored" data-anchor-id="youre-writing-for-everyone-which-means-no-one">You’re Writing for Everyone, Which Means No One</h2>
<p>You’re going to write a transdisciplinary proposal that fits into multiple panels. This will feel strategic. It’s actually a trap.</p>
<p>You can’t assume background knowledge in anything. Every discipline has its own language, its own implicit assumptions, its own way of framing problems. How do you write for everyone without writing for no one? How do you balance depth and accessibility when your readers might come from entirely different fields?</p>
<p>Maybe the answer is simpler than you think: assume less in general, but write it in an interesting way. Don’t dumb it down—just explain more. Make your enthusiasm for the ideas carry the reader through the explanations they need.</p>
<p>I still don’t know if you solved this problem. I hope the reviewers will tell us.</p>
</section>
<section id="the-structure-you-think-you-have" class="level2">
<h2 class="anchored" data-anchor-id="the-structure-you-think-you-have">The Structure You Think You Have</h2>
<p>You think you have good structure. You don’t.</p>
<p>What you need: the same subheadings for each Work Package. Visual emphasis—color, even. Clear blocks for deliverables and contingency planning. Make it obvious what you’ll produce and what you’ll do when (not if) things don’t go according to plan.</p>
<p>Here’s what structure is really about: convincing reviewers that you have a plan and that you’re worth the money. Every Work Package should make it crystal clear what you’re going to deliver, when you’re going to deliver it, and what could go wrong.</p>
<p>Also, try to write it so readers don’t need to read everything linearly. Each section should stand somewhat independently. Reviewers are busy. Give them permission to jump to what matters to them. They should be able to skip around and still understand that you know what you’re doing and that funding you makes sense.</p>
<p>You won’t get this right on the first try. Or the second. Keep iterating.</p>
</section>
<section id="on-intensity-and-timing" class="level2">
<h2 class="anchored" data-anchor-id="on-intensity-and-timing">On Intensity and Timing</h2>
<p>You’re going to wonder if you should start earlier. Don’t.</p>
<p>Work in waves. One full day exclusively on the proposal, then wait for new feedback or inspiration before opening the document again. This rhythm keeps the intensity without burning you out.</p>
<p>And yes, the intensity is necessary. Some things can’t be done slowly.</p>
</section>
<section id="lead-with-the-answer" class="level2">
<h2 class="anchored" data-anchor-id="lead-with-the-answer">Lead with the Answer</h2>
<p>You’re going to slowly—too slowly—move toward using what’s called the McKinsey Pyramid Principle <span class="citation" data-cites="minto2009pyramid">(<a href="#ref-minto2009pyramid" role="doc-biblioref">Minto 2009</a>)</span>. Stop resisting this. Just do it from the start.</p>
<p>Here’s the deal: Instead of building up to your point (how you naturally think), start with the answer and then provide supporting arguments and evidence. Barbara Minto developed this approach at McKinsey for communicating with busy executives—which is basically what grant reviewers are.</p>
<p>Why? Because reviewers are busy. They need to grasp your core contribution immediately. Lead with the answer. Tell them what you’re going to do and why it matters. Then—and only then—show them the supporting details.</p>
<p>You’re going to resist this because it feels unnatural, like you’re giving away the ending. Do it anyway.</p>
</section>
<section id="ai-is-helpful-but-forgetful" class="level2">
<h2 class="anchored" data-anchor-id="ai-is-helpful-but-forgetful">AI Is Helpful But Forgetful</h2>
<p>You’re going to use AI extensively:</p>
<ul>
<li>Prompting it to act as reviewers from various disciplines</li>
<li>Using Deep Research and platforms like FutureHouse for literature review</li>
<li>Getting help finding effective examples</li>
</ul>
<p>But here’s what you need to know: <strong>AI forgets things across long documents.</strong></p>
<p>When you’re working on a 15-20 page proposal, edits in one section require changes elsewhere. The introduction needs updating after you rework the objectives. A change in methodology impacts your timeline. Your risk mitigation needs to align with your deliverables.</p>
<p>AI doesn’t naturally track these dependencies. You become the keeper of the narrative arc, the one who remembers what you said ten pages ago. The iterative process of checking for consistency, updating multiple sections, ensuring coherence—that’s all you.</p>
<p>Is it worth using AI? Yes. But it’s not magic. It’s a tool that requires active management.</p>
</section>
<section id="give-yourself-permission-to-write-badly" class="level2">
<h2 class="anchored" data-anchor-id="give-yourself-permission-to-write-badly">Give Yourself Permission to Write Badly</h2>
<p>Anne Lamott writes in <em>Bird by Bird</em> that perfectionism is “the voice of the oppressor” and “the main obstacle between you and a shitty first draft.” <span class="citation" data-cites="lamott1994bird">(<a href="#ref-lamott1994bird" role="doc-biblioref">Lamott 1994</a>)</span></p>
<p>Listen to her.</p>
<p>Don’t start in the official ERC template. Write one long messy document first. Give yourself permission to write badly, to explore, to ramble. When you share it for feedback, you can say: “This is not yet the ERC proposal.” That distinction matters. It gives both you and your readers permission to focus on the ideas rather than the polish.</p>
<p>Then, after feedback, move it to the template. Write Part B1 first, then B2. Share both. Iterate. Rewrite. Iterate again.</p>
<p>The messiness is part of the process, not a sign that you’re doing it wrong.</p>
</section>
<section id="that-harsh-feedback-you-need-it" class="level2">
<h2 class="anchored" data-anchor-id="that-harsh-feedback-you-need-it">That Harsh Feedback? You Need It</h2>
<p>Someone is going to destroy your Part B2. Just absolutely tear it apart.</p>
<p>It’s going to hurt. And then, surprisingly, it’s going to help enormously.</p>
<p>The harsh feedback will give you the push you need to attempt another complete rewrite when you’re feeling unmotivated and lacking confidence. Sometimes the feedback that stings the most is exactly what you need to hear.</p>
<p>Try to remember that when you’re in the moment of pain.</p>
</section>
<section id="what-youd-change-and-what-you-wouldnt" class="level2">
<h2 class="anchored" data-anchor-id="what-youd-change-and-what-you-wouldnt">What You’d Change (And What You Wouldn’t)</h2>
<p>You’re going to wish you’d converged earlier on which panel to target. But the story develops in the process of writing it. How can you know which panel you’re targeting before you know what story you’re telling? Maybe this is one of those things that can’t be optimized.</p>
<p>You’re also going to almost miss formal requirements—confirming your PhD defense date, for instance. Without institutional support, you would have completely overlooked these. Next time, make a checklist of procedural matters from the start.</p>
<p>But starting earlier? No.&nbsp;The intensity of the compressed timeline is necessary, not just stressful.</p>
</section>
<section id="what-this-is-really-about" class="level2">
<h2 class="anchored" data-anchor-id="what-this-is-really-about">What This Is Really About</h2>
<p>Here’s what you need to understand: Grant writing is as much about managing yourself—your anxiety, your relationship with success and failure, your writing process—as it is about the research.</p>
<p>Are you playing the finite game or the infinite game? Are you optimizing for winning, or for continuing to play?</p>
<p>The proposal you’re about to write is valuable beyond its immediate outcome. It’s a crystallization of your thinking, a test of your communication, a forcing function for clarity. Whether you win this particular finite game or not, the infinite game—your research, your contribution to the field, the questions that genuinely excite you—continues.</p>
<p>Writing the proposal will help you crystallize ideas. It will help you find people who are good sounding boards. It will give you clear signals that your writing still isn’t as clear as you think it is.</p>
<p>These things are valuable regardless of the outcome.</p>
</section>
<section id="a-final-note" class="level2">
<h2 class="anchored" data-anchor-id="a-final-note">A Final Note</h2>
<p>I don’t know yet what the outcome will be. I’m still skeptical about whether this proposal will “fly”—some ideas may require too much shared background knowledge that reviewers won’t have.</p>
<p>But I’m excited about the ideas regardless. We’ll find ways to pursue them no matter what happens.</p>
<p>Remember which game you’re really playing.</p>
<p>And now, I suppose, back to those revisions.</p>
<p>With solidarity and hope,<br>
Your slightly-less-young self</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-carse1986finite" class="csl-entry" role="listitem">
Carse, James P. 1986. <em>Finite and Infinite Games</em>. New York: Free Press.
</div>
<div id="ref-lamott1994bird" class="csl-entry" role="listitem">
Lamott, Anne. 1994. <em>Bird by Bird: Some Instructions on Writing and Life</em>. New York: Anchor Books.
</div>
<div id="ref-minto2009pyramid" class="csl-entry" role="listitem">
Minto, Barbara. 2009. <em>The Pyramid Principle: Logic in Writing and Thinking</em>. 3rd ed. Harlow, England: Pearson Education.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/kjablonka\.com\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/kevin-maik-jablonka/">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/kjappelbaum">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://mailhide.io/e/o4LeOUlq">
      <i class="bi bi-envelope" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://scholar.google.com/citations?user=R2ntI8IAAAAJ&amp;hl=en">
      <i class="bi bi-mortarboard-fill" role="img">
</i> 
    </a>
  </li>  
</ul>
    <div class="toc-actions"><ul><li><a href="https://github.com/kjappelbaum/kjappelbaum.github.io/edit/main/blog/posts/writing_erc/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>